# Synchronizedèˆ‡é–å‡ç´š


## Synchronizedçš„æ€§èƒ½è®ŠåŒ–

* Java5ä»¥å‰ï¼Œåªæœ‰synchronizedï¼Œé€™æ˜¯æ“ä½œç³»çµ±ç´šåˆ¥çš„é‡é‡ç´šæ“ä½œ

  * é‡é‡ç´šé–ï¼Œå‡å¦‚ç«¶çˆ­æ¿€çƒˆçš„è©±ï¼Œæ€§èƒ½æ€¥é½ä¸‹é™
  * **æœƒç‰½æ¶‰ç”¨æˆ¶æ…‹å’Œå…§æ ¸æ…‹çš„åˆ‡æ›(å®¹æ˜“å°è‡´é˜»å¡)**![image.png](./assets/image.png)
* Java6é–‹å§‹ç‚ºäº†æ¸›å°‘ç²å¾—é–å’Œé‡‹æ”¾é–å¸¶ä¾†çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†**è¼•é‡é–å’Œåå‘é–**ï¼Œéœ€è¦æœ‰å€‹é€æ­¥å‡ç´šçš„éç¨‹ï¼Œåˆ¥ä¸€é–‹å§‹åˆ°é‡é‡ç´šé–ã€‚

## Synchronizedé–ç¨®é¡å’Œå‡ç´šæµç¨‹

### å‡ç´šæµç¨‹

* synchronizedç”¨çš„é–æ˜¯å­˜åœ¨Javaå°è±¡é ­è£¡çš„Mark Wordä¸­ï¼Œé–å‡ç´šåŠŸèƒ½ä¸»è¦ä¾è³´Mark Wordä¸­é–æ¨™èªŒä½å’Œé‡‹æ”¾åå‘é–æ¨™èªŒä½![image.png](./assets/1709091816427-image.png)
* é–æŒ‡å‘
  * **åå‘é–ï¼šMark Wordå­˜å„²çš„æ˜¯åå‘çš„ç·šç¨‹ID**
  * **è¼•é‡é–ï¼šMark Wordå­˜å„²çš„æ˜¯æŒ‡å‘ç·šç¨‹æ£§ä¸­çš„Lock Recordçš„æŒ‡é‡**
  * **é‡é‡é–ï¼šMark Wordå­˜å„²çš„æ˜¯æŒ‡å‘å †ä¸­çš„Monitorå°è±¡çš„æŒ‡é‡**

### ç„¡é–

åˆå§‹ç‹€æ…‹ï¼Œä¸€å€‹å°è±¡è¢«å¯¦ä¾‹åŒ–å¾Œï¼Œå¦‚æœé‚„æ²’æœ‰è¢«ä»»ä½•ç·šç¨‹ç«¶çˆ­é–ï¼Œé‚£ä»–å°±ç‚ºç„¡é–ç‹€æ…‹(**001**)

HashCodeæ˜¯ç”±æ¯çµ„å­—ç¯€ç”±å³ä¸‹å¾€å·¦ä¸Šçœ‹çš„

![image.png](./assets/1709093089109-image.png)

### åå‘é–

**å–®ç·šç¨‹ç«¶çˆ­**ï¼Œç•¶ç·šç¨‹Aç¬¬ä¸€æ¬¡ç«¶çˆ­åˆ°é–æ™‚ï¼Œé€šéä¿®æ”¹Mark Wordä¸­çš„åå‘ç·šç¨‹IDã€åå‘æ¨¡å¼ã€‚å¦‚æœä¸å­˜åœ¨å…¶ä»–ç·šç¨‹ç«¶çˆ­ï¼Œé‚£éº¼æŒæœ‰åå‘é–çš„ç·šç¨‹å°‡æ°¸é ä¸éœ€è¦é€²è¡ŒåŒæ­¥ã€‚

**ç•¶åŒä¸€æ®µåŒæ­¥ä»£ç¢¼ä¸€ç›´è¢«åŒä¸€å€‹ç·šç¨‹å¤šæ¬¡è¨ªå•ï¼Œç”±æ–¼åªæœ‰ä¸€å€‹ç·šç¨‹é‚£éº¼è©²ç·šç¨‹åœ¨å¾ŒçºŒè¨ªå•æ™‚ä¾¿æœƒè‡ªå‹•ç²å¾—é–ã€‚**(é¿å…å¤šæ¬¡ç”¨æˆ¶æ…‹å’Œå…§æ ¸æ…‹çš„åˆ‡æ›)

#### çµè«–

* HotSpotçš„ä½œè€…ç¶“éç ”ç©¶ç™¼ç¾ï¼Œå¤šç·šç¨‹å¤§å¤šæƒ…æ³ä¸‹ï¼Œé–ä¸åƒ…ä¸å­˜åœ¨å¤šç·šç¨‹ç«¶çˆ­ï¼Œé‚„å­˜åœ¨é–**ç”±åŒä¸€å€‹ç·šç¨‹å¤šæ¬¡ç²å¾—çš„æƒ…æ³**ã€‚åå‘é–å°±æ˜¯åœ¨é€™ç¨®æƒ…æ³ä¸‹å‡ºç¾çš„ï¼Œä»–çš„å‡ºç¾æ˜¯ç‚ºè§£æ±º**åªæœ‰åœ¨ä¸€å€‹ç·šç¨‹åŸ·è¡ŒåŒæ­¥æ™‚æé«˜æ€§èƒ½**ã€‚
* åå‘é–æœƒæœƒåå‘æ–¼ç¬¬ä¸€å€‹è¨ªå•é–çš„ç·šç¨‹ï¼Œå¦‚æœåœ¨æ¥ä¸‹ä¾†çš„é‹è¡Œéç¨‹ä¸­ï¼Œè©²é–æ²’æœ‰è¢«å…¶ä»–ç·šç¨‹è¨ªå•ï¼Œå‰‡æŒæœ‰åå‘é–çš„ç·šç¨‹å°‡æ°¸é ä¸éœ€è¦è§¸ç™¼åŒæ­¥ã€‚ä¹Ÿå³åå‘é–åœ¨è³‡æºæ²’æœ‰ç«¶çˆ­æƒ…æ³ä¸‹æ¶ˆé™¤äº†åŒæ­¥èªå¥ï¼Œé€£CASéƒ½ä¸åšäº†ï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚

#### ç†è«–

åœ¨å¯¦éš›æ‡‰ç”¨é‹è¡Œéç¨‹ä¸­ç™¼ç¾ï¼Œ"é–ç¸½æ˜¯åŒä¸€å€‹ç·šç¨‹æŒæœ‰ï¼Œå¾ˆå°‘ç™¼ç”Ÿç«¶çˆ­"ï¼Œä¹Ÿå°±æ˜¯èªª**é–ç¸½æ˜¯è¢«ç¬¬ä¸€å€‹ä½”ç”¨ä»–çš„ç·šç¨‹æŒæœ‰ï¼Œé€™å€‹ç·šç¨‹å°±æ˜¯é–çš„åå‘ç·šç¨‹**ã€‚é‚£éº¼åªéœ€è¦åœ¨é–ç¬¬ä¸€æ¬¡è¢«æ“æœ‰çš„æ™‚å€™ï¼Œè¨˜éŒ„ä¸‹åå‘ç·šç¨‹IDã€‚é€™æ¨£åå‘ç·šç¨‹å°±ä¸€ç›´æŒæœ‰è‘—é–(å¾ŒçºŒé€™å€‹ç·šç¨‹é€²å…¥å’Œé€€å‡ºé€™æ®µåŠ äº†åŒæ­¥é–çš„ä»£ç¢¼å¡Šæ™‚ï¼Œ**ä¸éœ€è¦å†æ¬¡åŠ é–å’Œé‡‹æ”¾é–**ã€‚è€Œæ˜¯ç›´æ¥å»æª¢æŸ¥é–çš„Mark Wordè£¡é¢æ˜¯ä¸æ˜¯æ”¾å¾—è‡ªå·±çš„ç·šç¨‹ID)ã€‚å¦‚æœç›¸ç­‰è¡¨ç¤ºåå‘é–äº‹åå‘æ–¼ç•¶å‰ç·šç¨‹çš„ï¼Œå°±ä¸éœ€è¦å˜—è©¦ç²å¾—é–äº†ï¼Œç›´åˆ°ç«¶çˆ­ç™¼ç”Ÿæ‰é‡‹æ”¾é–ã€‚ä»¥å¾Œæ¯æ¬¡åŒæ­¥ï¼Œæª¢æŸ¥é–çš„åå‘ç·šç¨‹IDèˆ‡ç•¶å‰ç·šç¨‹IDæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ç›´æ¥é€²å…¥åŒæ­¥ã€‚ç„¡éœ€æ¯æ¬¡åŠ é–éƒ½å»CASæ›´æ–°å°è±¡é ­ã€‚**å¦‚æœè‡ªå§‹è‡³çµ‚é–çš„ç·šç¨‹åªæœ‰ä¸€å€‹ï¼Œå¾ˆæ˜é¡¯åå‘é–å¹¾ä¹æ²’æœ‰é¡å¤–é–‹éŠ·ï¼Œæ€§èƒ½æ¥µé«˜**ã€‚å¦‚æœä¸ç­‰ï¼Œè¡¨ç¤ºç™¼ç”Ÿäº†ç«¶çˆ­ï¼Œé–å·²ç¶“ä¸æ˜¯ç¸½æ˜¯åå‘æ–¼åŒä¸€å€‹ç·šç¨‹äº†ï¼Œé€™å€‹æ™‚å€™æœƒå˜—è©¦ä½¿ç”¨CASä¾†æ›¿æ›Mark Wordè£¡é¢çš„ç·šç¨‹IDç‚ºæ–°çš„ç·šç¨‹IDã€‚

* **ç«¶çˆ­æˆåŠŸ**ï¼Œè¡¨ç¤ºä¹‹å‰çš„ç·šç¨‹ä¸å­˜åœ¨äº†ï¼ŒMark Wordè£¡é¢çš„ç·šç¨‹IDç‚ºæ–°ç·šç¨‹çš„IDï¼Œé–ä¸æœƒå‡ç´šï¼Œä»ç„¶ç‚ºåå‘é–ã€‚
* **ç«¶çˆ­å¤±æ•—**ï¼Œé€™æ™‚å€™å¯èƒ½éœ€è¦å‡ç´šè®Šç‚ºè¼•é‡ç´šé–ï¼Œæ‰èƒ½ä¿è­‰ç·šç¨‹é–“å…¬å¹³ç«¶çˆ­é–ã€‚

ğŸ’¡**åå‘é–åªæœ‰é‡åˆ°å…¶ä»–ç·šç¨‹å˜—è©¦ç«¶çˆ­åå‘é–æ™‚ï¼ŒæŒæœ‰åå‘é–çš„ç·šç¨‹æ‰æœƒé‡‹æ”¾é–ï¼Œç·šç¨‹æ˜¯ä¸æœƒä¸»å‹•é‡‹æ”¾åå‘é–çš„**ã€‚

#### æŠ€è¡“å¯¦ç¾

ä¸€å€‹synchronizedæ–¹æ³•è¢«ä¸€å€‹ç·šç¨‹æ¶åˆ°äº†é–æ™‚ï¼Œé‚£é€™å€‹æ–¹æ³•æ‰€åœ¨çš„å°è±¡å°±æœƒåœ¨å…¶æ‰€åœ¨çš„Mark Wordä¸­å°‡åå‘é–ä¿®æ”¹ç‹€æ…‹ä½ï¼ŒåŒæ™‚é‚„æœƒæœ‰ä½”ç”¨å‰54ä½ä¾†å­˜å„²ç·šç¨‹æŒ‡é‡ä½œç‚ºæ¨™ç¤ºã€‚è‹¥è©²ç·šç¨‹å†æ¬¡è¨ªå•åŒä¸€å€‹synchronizedæ–¹æ³•æ™‚ï¼Œè©²ç·šç¨‹åªéœ€å»å°è±¡é ­çš„Mark Wordä¸­å»åˆ¤æ–·ä¸€ä¸‹æ˜¯å¦æœ‰åå‘é–æŒ‡å‘æœ¬èº«çš„IDï¼Œç„¡éœ€å†é€²å…¥Monitorå»ç«¶çˆ­å°è±¡äº†ã€‚![image.png](./assets/1709140504865-image.png)



#### é–‹å•Ÿåå‘é–

* æŸ¥çœ‹åå‘é–ç›¸é—œå…§å®¹(Java15ä¹‹å¾Œæ²’æœ‰åå‘é–äº†)
  ![image.png](./assets/1709145835160-image.png)

![image.png](./assets/1709145580800-image.png)


#### åå‘é–çš„æ’¤éŠ·

* ç•¶æœ‰å¦ä¸€å€‹ç·šç¨‹é€æ­¥ä¾†ç«¶çˆ­é–æ™‚ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨åå‘é–äº†ï¼Œè¦å‡ç´šç‚ºè¼•é‡ç´šé–ï¼Œä½¿ç”¨çš„æ˜¯ç­‰åˆ°ç«¶çˆ­å‡ºç¾æ‰é‡‹æ”¾é–çš„çš„æ©Ÿåˆ¶ã€‚
* ç«¶çˆ­ç·šç¨‹å˜—è©¦CASæ›´æ–°å°è±¡é ­å¤±æ•—ï¼Œæœƒç­‰å¾…åˆ°å…¨å±€å®‰å…¨é»(æ­¤æ™‚ä¸æœƒåŸ·è¡Œä»»ä½•ä»£ç¢¼)æ’¤éŠ·åå‘é–ã€‚
  * ç¬¬ä¸€å€‹ç·šç¨‹æ­£åœ¨åŸ·è¡Œsynchronizedæ–¹æ³•(è™•æ–¼åŒæ­¥å¡Š)ï¼Œä»–é‚„æ²’æœ‰åŸ·è¡Œå®Œï¼Œå…¶ä»–ç·šç¨‹ä¾†æ¶å¥ªï¼Œè©²åå‘é–æœƒè¢«å–æ¶ˆæ‰ä¸¦å‡ºç¾**é–å‡ç´š**ã€‚æ­¤æ™‚è¼•é‡é–ç”±åŸå…ˆæŒæœ‰åå‘é–çš„ç·šç¨‹æŒæœ‰ï¼Œç¹¼çºŒåŸ·è¡Œå…¶åŒæ­¥ä»£ç¢¼ï¼Œè€Œæ­£åœ¨ç«¶çˆ­çš„ç·šç¨‹æœƒé€²å…¥è‡ªæ—‹ç­‰å¾…ç²å¾—è©²è¼•é‡ç´šé–ã€‚
  * ç¬¬ä¸€å€‹ç·šç¨‹åŸ·è¡Œå®Œæˆsynchronizedæ–¹æ³•(é€€å‡ºåŒæ­¥å¡Š)ï¼Œå‰‡å°‡å°è±¡é ­è¨­ç½®æˆç„¡é–ç‹€æ…‹ä¸¦æ’¤éŠ·åå‘é–ï¼Œé‡æ–°åå‘ã€‚
  * ![image.png](./assets/1709147411647-image.png)

ğŸ’¡ Java15ä»¥å¾Œé€æ­¥å»¢æ£„åå‘é–ï¼Œéœ€è¦æ‰‹å‹•é–‹å•Ÿ -> é–‹éŠ·æˆæœ¬å¤§


### è¼•é‡ç´šé–

**å¤šç·šç¨‹ç«¶çˆ­ï¼Œä½†ä»»æ„æ™‚å€™æœ€å¤šåªæœ‰ä¸€å€‹æœ€å¤šåªæœ‰ä¸€å€‹ç·šç¨‹ç«¶çˆ­**ï¼Œå³ä¸å­˜åœ¨é–ç«¶çˆ­å¤ªéæ¿€çƒˆçš„æƒ…æ³ï¼Œä¹Ÿå°±æ²’æœ‰ç·šç¨‹é˜»å¡ã€‚

#### ä¸»è¦ä½œç”¨

æœ‰ç·šç¨‹ä¾†åƒèˆ‡é–çš„ç«¶çˆ­ï¼Œä½†æ˜¯ç²å–é–çš„è¡çªæ™‚é–“æ¥µçŸ­ï¼Œ**æœ¬è³ªå°±æ˜¯è‡ªæ—‹é–CAS**

#### è¼•é‡é–çš„ç²å–

è¼•é‡ç´šé–æ˜¯ç‚ºäº†åœ¨ç·šç¨‹è¿‘ä¹äº¤æ›¿åŸ·è¡ŒåŒæ­¥å¡Šæ™‚æé«˜æ€§èƒ½ã€‚

ä¸»è¦ç›®çš„ï¼šåœ¨æ²’æœ‰å¤šç·šç¨‹ç«¶çˆ­çš„å‰æä¸‹ï¼Œé€šé**CAS**æ¸›å°‘é‡é‡ç´šé–ä½¿ç”¨æ“ä½œç³»çµ±äº’æ–¥é‡ç”¢ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ï¼Œèªªç™½äº†**å…ˆè‡ªæ—‹ï¼Œä¸è¡Œæ‰å‡ç´šé˜»å¡**ã€‚

å‡ç´šæ™‚æ©Ÿï¼šç•¶é—œé–‰åå‘é–åŠŸèƒ½æˆ–å¤šç·šç¨‹ç«¶çˆ­åå‘é–æœƒå°è‡´åå‘é–å‡ç´šç‚ºè¼•é‡ç´šé–ã€‚

![image.png](./assets/1709170629276-image.png)

![image.png](./assets/1709170936290-image.png)

#### æ¡ˆä¾‹

```java=
//é—œé–‰åå‘é–    -XX:-UseBiasedLocking  å°±æœƒç›´æ¥ä½¿ç”¨è¼•é‡ç´šé–
Object o = new Object();
    new Thread(() -> {
        synchronized (o) {
            System.out.println(ClassLayout.parseInstance(o).toPrintable());
        }
}, "t1").start();
```

è‡ªæ—‹é”åˆ°ä¸€å®šæ¬¡æ•¸å’Œç¨‹åº¦(Java6ä¹‹å¾Œæ˜¯**è‡ªæ—‹è‡ªé©æ‡‰é–**)

* ç·šç¨‹å¦‚æœè‡ªæ—‹æˆåŠŸäº†ï¼Œé‚£ä¸‹æ¬¡è‡ªæ—‹çš„æœ€å¤§æ¬¡æ•¸æœƒ**å¢åŠ **ï¼Œå› ç‚ºJVMèªç‚ºæ—¢ç„¶ä¸Šæ¬¡æˆåŠŸäº†ï¼Œé‚£éº¼é€™æ¬¡ä¹Ÿå¤§æ©Ÿç‡æœƒæˆåŠŸã€‚
* å¦‚æœå¾ˆå°‘è‡ªæ—‹æˆåŠŸï¼Œé‚£éº¼ä¸‹æ¬¡æœƒ**æ¸›å°‘**è‡ªæ—‹çš„æ¬¡æ•¸ç”šè‡³ä¸è‡ªæ—‹ï¼Œé¿å…CPUç©ºè½‰ã€‚

è¼•é‡é–å’Œåå‘é–çš„å€åˆ¥ï¼š

* çˆ­å¥ªè¼•é‡é–å¤±æ•—æ™‚ï¼Œæœƒè‡ªæ—‹å˜—è©¦æ¶ä½”é–ã€‚
* è¼•é‡é–æ¯æ¬¡é€€å‡ºåŒæ­¥å¡Šéƒ½éœ€è¦é‡‹æ”¾é–ï¼Œè€Œåå‘é–æ˜¯åœ¨ç«¶çˆ­ç™¼ç”Ÿæ™‚æ‰é‡‹æ”¾é–ã€‚


### é‡é‡ç´šé–

æœ‰å¤§é‡çš„ç·šç¨‹åƒèˆ‡é–çš„ç«¶çˆ­ï¼Œè¡çªæ€§å¾ˆé«˜ã€‚

#### åŸç†

![image.png](./assets/1709261703095-image.png)
Javaä¸­çš„synchronizedé‡é‡ç´šé–ï¼Œæ˜¯åŸºæ–¼é€²å…¥å’Œé€€å‡ºMonitorå°è±¡å¯¦ç¾çš„ï¼Œåœ¨ç·¨è­¯æ™‚æœƒå°‡åŒæ­¥å¡Šçš„é–‹å§‹ä½ç½®æ’å…¥monitor enteræŒ‡ä»¤ï¼Œåœ¨çµæŸä½ç½®æ’å…¥monitor exitæŒ‡ä»¤ã€‚

ç•¶ç·šç¨‹åŸ·è¡Œåˆ°monitor enteræŒ‡ä»¤æ™‚ï¼Œæœƒå˜—è©¦ç²å–å°è±¡å°æ‡‰çš„Monitoræ‰€æœ‰æ¬Šï¼Œå¦‚æœç²å–åˆ°äº†ï¼Œå³ç²å–åˆ°äº†é–ï¼Œæœƒåœ¨Monitorçš„ownerä¸­å­˜æ”¾ç•¶å‰ç·šç¨‹çš„IDï¼Œé€™æ¨£ä»–å°‡è™•æ–¼é–å®šç‹€æ…‹ï¼Œé™¤éé€€å‡ºåŒæ­¥å¡Šï¼Œå¦å‰‡å…¶ä»–ç·šç¨‹ç„¡æ³•ç²å–åˆ°é€™å€‹Monitorã€‚


### ç¸½çµ

![image.png](./assets/1709340434477-image.png)

#### é–å‡ç´šå¾Œï¼Œå“ˆå¸Œç¢¼å»å“ªäº†

![image.png](./assets/1709340660844-image.png)

* **ç„¡é–**ç‹€æ…‹ä¸‹ï¼ŒMark Wordä¸­å¯ä»¥å­˜å„²å°è±¡çš„identity hash codeå€¼ã€‚ç•¶å°è±¡çš„`hashCode()`æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«èª¿ç”¨æ™‚ï¼ŒJVMæœƒç”Ÿæˆå°æ‡‰çš„identity hash codeå€¼ä¸¦å°‡è©²å€¼å­˜å„²åˆ°Mark Wordä¸­ã€‚
* å°æ–¼**åå‘é–**ï¼Œåœ¨ç·šç¨‹ç²å–åå‘é–æ™‚ï¼Œæœƒç”¨Thread IDå’Œepochå€¼(ç†è§£ç‚ºæ™‚é–“æˆ³)è¦†è“‹identity hash codeæ‰€åœ¨çš„ä½ç½®ã€‚**å¦‚æœä¸€å€‹å°è±¡çš„`hashCode()`æ–¹æ³•å·²ç¶“è¢«èª¿ç”¨éä¸€æ¬¡ï¼Œé€™å€‹å°è±¡ä¸èƒ½è¢«è¨­ç½®åå‘é–**ã€‚å› ç‚ºå¦‚æœå¯ä»¥çš„è©±ï¼Œé‚£Mark Wordä¸­çš„identity hash codeå¿…ç„¶æœƒè¢«åå‘ç·šç¨‹idè¦†è“‹ï¼Œå°±æœƒé€ æˆåŒä¸€å€‹å°è±¡å‰å¾Œå…©æ¬¡èª¿ç”¨`hashCode()`æ–¹æ³•å¾—åˆ°çš„çµæœä¸ä¸€æ¨£ã€‚
* å‡ç´šç‚º**è¼•é‡é–**æ™‚ï¼ŒJVMæœƒåœ¨ç•¶å‰ç·šç¨‹çš„æ£§ä¸­å‰µå»ºä¸€å€‹é–ç´€éŒ„(Lock Record)ç©ºé–“ï¼Œç”¨æ–¼å­˜å„²é–å°è±¡çš„Mark Wordæ‹·è²ï¼Œè©²æ‹·è²ä¸­å¯ä»¥åŒ…å«identity hash codeï¼Œæ‰€ä»¥**è¼•é‡ç´šé–å¯ä»¥å’Œidentity hash codeå…±å­˜**ï¼Œå“ˆå¸Œç¢¼å’ŒGCå¹´é½¡è‡ªç„¶ä¿å­˜åœ¨æ­¤ï¼Œé‡‹æ”¾é–å¾Œæœƒå°‡é€™äº›ä¿¡æ¯å¯«å›åˆ°å°è±¡é ­ã€‚
* å‡ç´šç‚º**é‡é‡é–**æ™‚ï¼ŒMark Wordä¿å­˜çš„é‡é‡ç´šé–æŒ‡é‡ï¼Œä»£è¡¨é‡é‡ç´šé–çš„ObjectMonitoré¡ä¸­æœ‰å­—æ®µç´€éŒ„éåŠ é–ç‹€æ…‹ä¸‹çš„Mark Wordï¼Œé–é‡‹æ”¾å¾Œä¹Ÿæœƒå°‡ä¿¡æ¯å¯«å›åˆ°å°è±¡é ­ã€‚

#### é–çš„å„ªç¼ºé»å°æ¯”

![image.png](./assets/1709342110237-image.png)

synchronizedé–å‡ç´šç¸½çµï¼š**å…ˆè‡ªæ—‹ï¼Œä¸è¡Œå†é˜»å¡**ã€‚

å¯¦éš›ä¸Šæ˜¯æŠŠä¹‹å‰çš„æ‚²è§€é–(é‡é‡ç´šé–)è®Šæˆåœ¨ä¸€å®šæ¢ä»¶ä¸‹ä½¿ç”¨åå‘é–å³ä½¿ç”¨è¼•é‡ç´šé–(è‡ªæ—‹é–CAS)çš„å½¢å¼ã€‚

synchronizedåœ¨ä¿®é£¾æ–¹æ³•å’Œä»£ç¢¼å¡Šåœ¨å­—ç¯€ç¢¼ä¸Šå¯¦ç¾æ–¹å¼æœ‰å¾ˆå¤§çš„å·®ç•°ï¼Œä½†æ˜¯å…§éƒ¨å¯¦ç¾é‚„æ˜¯åŸºæ–¼å°è±¡é ­çš„Mark Wordä¾†å¯¦ç¾çš„ã€‚

JDK 1.6ä¹‹å‰synchronizedä½¿ç”¨çš„æ˜¯é‡é‡ç´šé–ï¼ŒJDK1.6ä¹‹å¾Œé€²è¡Œäº†å„ªåŒ–ï¼Œ**æ“æœ‰äº†ç„¡é–->åå‘é–->è¼•é‡ç´šé–->é‡é‡ç´šé–çš„å‡ç´šéç¨‹**ï¼Œè€Œä¸æ˜¯ä»€éº¼æƒ…æ³éƒ½ç”¨é‡é‡ç´šé–ã€‚

![image.png](./assets/1709342367230-image.png)
