# CAS

compare and swap的縮寫，翻譯成**比較並交換**，實現並發算法時常用到的一種技術。<br>
它包含3個操作數：內存位置的值、預期值及更新值。<br>

執行CAS操作時，將內存位置的值與預期值比較：
* 如果**相匹配**，那麼處理器會自動將該位置值更新為新值。
* 如果**不匹配**，處理器不做任何操作，多個線程同時執行CAS操作只有一個會成功。

CAS有3個操作數，內存位置值V、舊的預期值A和要修改的更新值B。<br>
當舊的預期值A和內存值V相同時，將內存值V修改為B，否則什麼都不做或重來。<br>
當他重來重試的這種行為稱為 - **自旋**

![img.png](img.png)

## 自旋鎖(spinlock)
CAS是自旋鎖的基礎，CAS利用CPU指令保證了操作的原子性，以達到鎖的效果，至於自旋呢，看字面意思也很明白，自己旋轉。<br>
是指嘗試獲取鎖的線程不會立即阻塞，而是**採用循環的方式去嘗試獲取鎖**，當線程發現鎖被佔用時，會不斷循環判斷鎖的狀態，直到獲取。這樣的好處是減少線程上下文切換的消耗，缺點是循環會**消耗CPU**